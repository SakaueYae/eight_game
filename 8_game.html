<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>間違い探しゲーム</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #game-container, #result-container, #announcement, #start-button {
            display: none;
        }
        .message {
            font-size: 24px;
            margin-top: 20px;
        }
        #images img {
            width: 600px;
            height: 400px;
        }
        button {
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="difficulty-selection">
        <h1>難易度選択</h1>
        <button data-difficulty="easy">Level1</button>
        <button data-difficulty="normal">Level2</button>
        <button data-difficulty="hard">Level3</button>
    </div>

    <div id="announcement" class="message">0番店</div>

    <div id="game-container">
        <div id="images">
            <img src="original.png" id="original-image" alt="Original Image">
            <img src="" id="game-image" alt="Game Image">
        </div>
        <div>
            <button id="back-button">引き返す</button>
            <button id="go-button">進む</button>
        </div>
        <div class="message" id="message"></div>
    </div>

    <div id="result-container">
        <div class="message" id="result-message"></div>
        <button id="retry-button">タイトルへ戻る</button>
        <button id="play-again-button">他の難易度で遊ぶ</button>
    </div>

    <script>
        $(document).ready(function() {
            let correctCount = 0;
            let requiredCorrect = 0;
            let currentImage = '';
            let difficulty = '';
            const gameImages = Array.from({length: 20}, (_, i) => `image/${i + 1}.png`); // 20枚のゲーム画像
            const originalImage = 'image/original.png'; // 元の画像（正解の基準）
            const difficulties = {
                easy: 4,
                normal: 6,
                hard: 9
            };

            function resetGame() {
                correctCount = 0;
                $('#game-container').hide();
                $('#result-container').hide();
                $('#announcement').hide();
                $('#difficulty-selection').show();
                $('#message').text('');
                $('#back-button').hide();
                $('#go-button').hide();
            }

            function showMessage(message) {
                $('#message').text(message);
            }

            function showResult(message) {
                $('#result-message').text(message);
                $('#announcement').hide(); // ゲームクリア時に~番店を非表示にする
                $('#game-container').hide();
                $('#result-container').show();
            }

            function getRandomImage() {
                // 50%の確率で元画像かダミー画像を選ぶ
                return Math.random() < 0.5 ? originalImage : gameImages[Math.floor(Math.random() * gameImages.length)];
            }

            function updateAnnouncement() {
                $('#announcement').text(correctCount + '番店');
            }

            $('button[data-difficulty]').on('click', function() {
                difficulty = $(this).data('difficulty');
                requiredCorrect = difficulties[difficulty];
                $('#difficulty-selection').hide();
                $('#announcement').text('0番店').show();
                $('#game-container').show();
                $('#original-image').hide();
                currentImage = originalImage; // 最初は元画像を表示
                $('#game-image').attr('src', currentImage).show();
                $('#back-button').hide(); // 0番店では引き返すボタンを非表示
                $('#go-button').show();
            });

            $('#back-button').on('click', function() {
                if (currentImage !== originalImage) {
                    correctCount++;
                    updateAnnouncement();
                    if (correctCount >= requiredCorrect) {
                        showResult('おめでとう！ ゲームをクリアしました。');
                    } else {
                        currentImage = getRandomImage();
                        $('#game-image').attr('src', currentImage);
                    }
                } else {
                    correctCount = 0;
                    $('#announcement').text('0番店');
                    currentImage = originalImage;
                    $('#game-image').attr('src', currentImage);
                }
                if (correctCount === 0) {
                    $('#back-button').hide(); // 0番店では引き返すボタンを非表示
                } else {
                    $('#back-button').show();
                }
            });

            $('#go-button').on('click', function() {
                if (currentImage === originalImage) {
                    correctCount++;
                    updateAnnouncement();
                    if (correctCount >= requiredCorrect) {
                        showResult('おめでとう！ ゲームをクリアしました。');
                    } else {
                        currentImage = getRandomImage();
                        $('#game-image').attr('src', currentImage);
                    }
                } else {
                    correctCount = 0;
                    $('#announcement').text('0番店');
                    currentImage = originalImage;
                    $('#game-image').attr('src', currentImage);
                }
                if (correctCount === 0) {
                    $('#back-button').hide(); // 0番店では引き返すボタンを非表示
                } else {
                    $('#back-button').show();
                }
            });

            $('#retry-button').on('click', function() {
                resetGame();
            });

            $('#play-again-button').on('click', function() {
                resetGame();
            });
        });
    </script>
</body>
</html>
